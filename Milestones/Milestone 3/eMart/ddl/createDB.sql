BEGIN
 DECLARE CONTINUE HANDLER FOR SQLSTATE '42704'
   BEGIN end;
 EXECUTE IMMEDIATE 'DROP TABLE T_ACCESS_TOKEN';
END;

CREATE TABLE T_ACCESS_TOKEN (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY, 
    DEVICE_ID VARCHAR(100) NOT NULL,
    ACCESS_TOKEN VARCHAR(100) NOT NULL,
    BIZ_KBN VARCHAR(100),
    OAUTH_ACCESS_TOKEN VARCHAR(4096),
    UPDATED_AT TIMESTAMP, 
    CREATED_AT TIMESTAMP, 
    CONSTRAINT PK_ACCESS_TOKEN PRIMARY KEY (ID),
    CONSTRAINT UN_ACCESS_TOKEN_DEVICE_ID UNIQUE (DEVICE_ID),
    CONSTRAINT UN_ACCESS_TOKEN_ACCESS_TOKEN UNIQUE (ACCESS_TOKEN)
);

BEGIN
 DECLARE CONTINUE HANDLER FOR SQLSTATE '42704'
   BEGIN end;
 EXECUTE IMMEDIATE 'DROP TABLE T_PBK_APPLICATION_CONFIGURATION';
END;

CREATE TABLE T_PBK_APPLICATION_CONFIGURATION (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY, 
    APP_SECRET CHAR(64), 
    APP_SECRET_STATUS CHAR(1),  
    UPDATED_AT TIMESTAMP, 
    CREATED_AT TIMESTAMP,
    CONSTRAINT PK_PBK_APPLICATION_CONFIGURATION PRIMARY KEY (ID)
);

BEGIN
 DECLARE CONTINUE HANDLER FOR SQLSTATE '42704'
   BEGIN end;
 EXECUTE IMMEDIATE 'DROP TABLE T_USER';
END;

CREATE TABLE T_USER (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY, 
    DEVICE_ID CHAR(36) NOT NULL, 
    ACCESS_TOKEN VARCHAR(4096), 
    ACCESS_TOKEN_ISSUED_AT TIMESTAMP, 
    APP_OS_TYPE CHAR(1), 
    APP_VERSION VARCHAR(15), 
    DEVICE_NAME VARCHAR(100), 
    DEVICE_OS_VERSION VARCHAR(15), 
    LAST_LOGIN_AT TIMESTAMP, 
    STATE CHAR(64), 
    STATE_ISSUED_AT TIMESTAMP, 
    UPDATED_AT TIMESTAMP, 
    CREATED_AT TIMESTAMP, 
    CONSTRAINT PK_USER PRIMARY KEY (ID),
    CONSTRAINT UN_USER_DEVICE_ID UNIQUE (DEVICE_ID)
);

BEGIN
 DECLARE CONTINUE HANDLER FOR SQLSTATE '42704'
   BEGIN end;
 EXECUTE IMMEDIATE 'DROP TABLE T_OAUTH_TOKEN';
END;

CREATE TABLE T_OAUTH_TOKEN (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY, 
    DEVICE_ID VARCHAR(100) NOT NULL,
    OAUTH_ACCESS_TOKEN VARCHAR(4096) NOT NULL, 
    OAUTH_REFRESH_TOKEN VARCHAR(4096), 
    OAUTH_SCOPE VARCHAR(1023), 
    OAUTH_TOKEN_EXPIRES_IN INTEGER, 
    OAUTH_TOKEN_ISSUED_AT TIMESTAMP, 
    UPDATED_AT TIMESTAMP, 
    CREATED_AT TIMESTAMP, 
    CONSTRAINT PK_OAUTH_TOKEN PRIMARY KEY (ID),
    CONSTRAINT UN_OAUTH_TOKEN_DEVICE_ID UNIQUE (DEVICE_ID)
);
